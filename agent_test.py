"""
ä¸€ä¸ªæç®€çš„ Web Agent éª¨æ¶ï¼Œå¸®åŠ©ä½ ç†è§£â€œæŒ‡ä»¤ -> æ€è€ƒ -> æ“ä½œâ€ä¸‰é˜¶æ®µç»“æ„ã€‚

è¿™ç‰ˆå¼€å§‹å¼•å…¥ Playwrightï¼Œæ‰“å¼€ä¸€ä¸ªçœŸå®çš„æµè§ˆå™¨é¡µé¢ã€‚
"""

from playwright.sync_api import sync_playwright


def get_user_instruction() -> str:
    """æ¨¡æ‹Ÿä»ç”¨æˆ·é‚£é‡Œæ¥æ”¶ä¸€ä¸ªè‡ªç„¶è¯­è¨€æŒ‡ä»¤ã€‚"""
    # çœŸå®æƒ…å†µï¼šæœªæ¥è¿™é‡Œä¼šä»å‘½ä»¤è¡Œå‚æ•° / Web æ¥å£ / å‰ç«¯ä¼ è¿›æ¥
    return "å¸®æˆ‘æŸ¥çœ‹æ·±åœ³æœªæ¥14å¤©å¤©æ°”ï¼Œå¹¶æ€»ç»“é€‚åˆæˆ·å¤–æ´»åŠ¨çš„æ—¥æœŸã€‚"


def think_about_plan(instruction: str) -> list[str]:
    """
    æ¨¡æ‹Ÿâ€œæ€è€ƒâ€é˜¶æ®µï¼šæ ¹æ®æŒ‡ä»¤ï¼Œäº§å‡ºä¸€ä¸ªéå¸¸ç²—ç³™çš„æ“ä½œè®¡åˆ’ã€‚

    æœªæ¥è¿™é‡Œä¼šæ”¹æˆï¼šè°ƒç”¨ Kimi APIï¼Œè®©æ¨¡å‹æ¥ç”Ÿæˆæ›´å¤æ‚çš„æ“ä½œåºåˆ—ã€‚
    """
    print("ğŸ§  [æ€è€ƒä¸­] æ ¹æ®æŒ‡ä»¤è§„åˆ’æµè§ˆå™¨æ“ä½œæ­¥éª¤...")
    plan = [
        "æ‰“å¼€æµè§ˆå™¨",
        "è®¿é—®æœç´¢å¼•æ“ï¼ˆå¦‚ https://www.baidu.comï¼‰",
        "æœç´¢ï¼šæ·±åœ³ æœªæ¥14å¤©å¤©æ°”",
        "æ‰“å¼€ä¸€ä¸ªæƒå¨å¤©æ°”ç½‘ç«™ç»“æœé¡µ",
        "é˜…è¯»å¹¶æ•´ç†æœªæ¥14å¤©çš„å¤©æ°”æƒ…å†µ",
        "æ ‡è®°é€‚åˆæˆ·å¤–æ´»åŠ¨çš„æ—¥æœŸï¼Œå¹¶ç»™å‡ºåŸå› ",
    ]
    return plan


def execute_plan(plan: list[str]) -> None:
    """
    â€œæ“ä½œâ€é˜¶æ®µçš„æœ€å°å¯è¿è¡Œç‰ˆæœ¬ï¼š
    - å…ˆæ‰“å°å‡ºè®¡åˆ’æ­¥éª¤
    - ç„¶åç”¨ Playwright æ‰“å¼€ä¸€ä¸ªçœŸå®æµè§ˆå™¨é¡µé¢
    """
    print("ğŸ–±ï¸ [æ‰§è¡Œä¸­] ä¸‹é¢æ˜¯ç†è®ºä¸Šè¦åœ¨æµè§ˆå™¨é‡Œæ‰§è¡Œçš„æ­¥éª¤ï¼š")
    for i, step in enumerate(plan, start=1):
        print(f"  Step {i}: {step}")

    print("\nğŸŒ [Playwright] å‡†å¤‡æ‰“å¼€ä¸€ä¸ªçœŸå®æµè§ˆå™¨é¡µé¢ï¼ˆç™¾åº¦é¦–é¡µç¤ºä¾‹ï¼‰...")
    with sync_playwright() as p:
        browser = p.chromium.launch(headless=False)  # headless=False æ–¹ä¾¿ä½ çœ‹åˆ°çª—å£
        page = browser.new_page()
        page.goto("https://www.baidu.com", wait_until="load")
        print("âœ… æµè§ˆå™¨å·²æ‰“å¼€ç™¾åº¦é¦–é¡µï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ–°çª—å£å¼¹å‡ºã€‚")
        # ä¸ºäº†è®©ä½ æœ‰æ—¶é—´çœ‹åˆ°é¡µé¢ï¼Œä¸è¦ç«‹åˆ»å…³é—­æµè§ˆå™¨
        input("æŒ‰ä¸‹å›è½¦é”®åå…³é—­æµè§ˆå™¨å¹¶ç»“æŸè„šæœ¬...")
        browser.close()


def main() -> None:
    """ä¸²èµ· æ•´ä¸ª â€˜æŒ‡ä»¤ -> æ€è€ƒ -> æ“ä½œâ€™ çš„æœ€å°é—­ç¯ã€‚"""
    print("==== Mini-Manus Day 1 éª¨æ¶ Demo ====")

    # 1. æŒ‡ä»¤
    instruction = get_user_instruction()
    print(f"ğŸ“¥ [æŒ‡ä»¤] {instruction}")

    # 2. æ€è€ƒ
    plan = think_about_plan(instruction)

    # 3. æ“ä½œ
    execute_plan(plan)

    print("âœ… Demo ç»“æŸï¼ˆç›®å‰è¿˜æ²¡æœ‰è°ƒç”¨ Kimiï¼Œåªæ˜¯æ‰“å¼€äº†ä¸€ä¸ªçœŸå®æµè§ˆå™¨ï¼‰")


if __name__ == "__main__":
    main()

